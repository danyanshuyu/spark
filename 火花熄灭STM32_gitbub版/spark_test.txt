; generated by ARM C/C++ Compiler, 4.1 [Build 567]
; commandline ArmCC [--list --debug -c --asm --interleave -ospark_test.o --asm_dir=.\ --list_dir=.\ --depend=spark_test.d --cpu=Cortex-M3 --apcs=interwork -O0 -I"E:\Program Files\Keil4\ARM\INC" -I"E:\Program Files\Keil4\ARM\INC\ST\STM32F10x" -D__MICROLIB --omf_browse=spark_test.crf User\Spark_test.c]
                          THUMB

                          AREA ||.text||, CODE, READONLY, ALIGN=2

                  Spark_test PROC
;;;22     *******************************************************************************/
;;;23     void Spark_test()
000000  483d              LDR      r0,|L1.248|
;;;24     {	
;;;25     	if(Single_num>0)      //如果一次中断计数单元火花个数不为0，则正常进行滑动计数
000002  6800              LDR      r0,[r0,#0]  ; Single_num
000004  2800              CMP      r0,#0
000006  d05d              BEQ      |L1.196|
;;;26     	{
;;;27     		if(Single_num>=SIGNAL_DANGER)
000008  483b              LDR      r0,|L1.248|
00000a  6800              LDR      r0,[r0,#0]  ; Single_num
00000c  280a              CMP      r0,#0xa
00000e  d315              BCC      |L1.60|
;;;28     		{
;;;29     			//喷水
;;;30     
;;;31     
;;;32     		  	//重新滑动计数
;;;33     			for(Cnt=0;Cnt<(sizeof(Spark)/sizeof(Spark[0]));Cnt++)
000010  2000              MOVS     r0,#0
000012  493a              LDR      r1,|L1.252|
000014  7008              STRB     r0,[r1,#0]
000016  e00a              B        |L1.46|
                  |L1.24|
;;;34     			{
;;;35     				Spark[Cnt] = 0;
000018  2000              MOVS     r0,#0
00001a  4939              LDR      r1,|L1.256|
00001c  4a37              LDR      r2,|L1.252|
00001e  7812              LDRB     r2,[r2,#0]  ; Cnt
000020  f8410022          STR      r0,[r1,r2,LSL #2]
000024  4835              LDR      r0,|L1.252|
000026  7800              LDRB     r0,[r0,#0]            ;33  ; Cnt
000028  1c40              ADDS     r0,r0,#1              ;33
00002a  4934              LDR      r1,|L1.252|
00002c  7008              STRB     r0,[r1,#0]            ;33
                  |L1.46|
00002e  4833              LDR      r0,|L1.252|
000030  7800              LDRB     r0,[r0,#0]            ;33  ; Cnt
000032  2805              CMP      r0,#5                 ;33
000034  d3f0              BCC      |L1.24|
;;;36     			}	
;;;37     			Single_Cnt = 0;
000036  2000              MOVS     r0,#0
000038  4932              LDR      r1,|L1.260|
00003a  7008              STRB     r0,[r1,#0]
                  |L1.60|
;;;38     		}
;;;39     
;;;40     		Spark[Single_Cnt++] = Single_num;
00003c  482e              LDR      r0,|L1.248|
00003e  6801              LDR      r1,[r0,#0]  ; Single_num
000040  4830              LDR      r0,|L1.260|
000042  7802              LDRB     r2,[r0,#0]  ; Single_Cnt
000044  7800              LDRB     r0,[r0,#0]  ; Single_Cnt
000046  1c40              ADDS     r0,r0,#1
000048  4b2e              LDR      r3,|L1.260|
00004a  7018              STRB     r0,[r3,#0]
00004c  482c              LDR      r0,|L1.256|
00004e  f8401022          STR      r1,[r0,r2,LSL #2]
;;;41     		
;;;42     		if(Single_Cnt>=5)
000052  4618              MOV      r0,r3
000054  7800              LDRB     r0,[r0,#0]  ; Single_Cnt
000056  2805              CMP      r0,#5
000058  db02              BLT      |L1.96|
;;;43     		{
;;;44     			Single_Cnt = 0;
00005a  2000              MOVS     r0,#0
00005c  4619              MOV      r1,r3
00005e  7008              STRB     r0,[r1,#0]
                  |L1.96|
;;;45     		}
;;;46     		
;;;47     		for(Cnt=0;Cnt<5;Cnt++)
000060  2000              MOVS     r0,#0
000062  4926              LDR      r1,|L1.252|
000064  7008              STRB     r0,[r1,#0]
000066  e00e              B        |L1.134|
                  |L1.104|
;;;48     		{
;;;49     			Cir_Spark_Sum += Spark[Cnt];
000068  4825              LDR      r0,|L1.256|
00006a  4924              LDR      r1,|L1.252|
00006c  7809              LDRB     r1,[r1,#0]  ; Cnt
00006e  f8500021          LDR      r0,[r0,r1,LSL #2]
000072  4925              LDR      r1,|L1.264|
000074  6809              LDR      r1,[r1,#0]  ; Cir_Spark_Sum
000076  4408              ADD      r0,r0,r1
000078  4923              LDR      r1,|L1.264|
00007a  6008              STR      r0,[r1,#0]  ; Cir_Spark_Sum
00007c  481f              LDR      r0,|L1.252|
00007e  7800              LDRB     r0,[r0,#0]            ;47  ; Cnt
000080  1c40              ADDS     r0,r0,#1              ;47
000082  491e              LDR      r1,|L1.252|
000084  7008              STRB     r0,[r1,#0]            ;47
                  |L1.134|
000086  481d              LDR      r0,|L1.252|
000088  7800              LDRB     r0,[r0,#0]            ;47  ; Cnt
00008a  2805              CMP      r0,#5                 ;47
00008c  dbec              BLT      |L1.104|
;;;50     		}
;;;51     
;;;52      		if(Cir_Spark_Sum>=TOTAL_DANGER)
00008e  481e              LDR      r0,|L1.264|
000090  6800              LDR      r0,[r0,#0]  ; Cir_Spark_Sum
000092  2814              CMP      r0,#0x14
000094  d32f              BCC      |L1.246|
;;;53     		{
;;;54     			//喷水
;;;55     
;;;56     
;;;57     			//重新滑动计数
;;;58     			for(Cnt=0;Cnt<(sizeof(Spark)/sizeof(Spark[0]));Cnt++)
000096  2000              MOVS     r0,#0
000098  4918              LDR      r1,|L1.252|
00009a  7008              STRB     r0,[r1,#0]
00009c  e00a              B        |L1.180|
                  |L1.158|
;;;59     			{
;;;60     				Spark[Cnt] = 0;
00009e  2000              MOVS     r0,#0
0000a0  4917              LDR      r1,|L1.256|
0000a2  4a16              LDR      r2,|L1.252|
0000a4  7812              LDRB     r2,[r2,#0]  ; Cnt
0000a6  f8410022          STR      r0,[r1,r2,LSL #2]
0000aa  4814              LDR      r0,|L1.252|
0000ac  7800              LDRB     r0,[r0,#0]            ;58  ; Cnt
0000ae  1c40              ADDS     r0,r0,#1              ;58
0000b0  4912              LDR      r1,|L1.252|
0000b2  7008              STRB     r0,[r1,#0]            ;58
                  |L1.180|
0000b4  4811              LDR      r0,|L1.252|
0000b6  7800              LDRB     r0,[r0,#0]            ;58  ; Cnt
0000b8  2805              CMP      r0,#5                 ;58
0000ba  d3f0              BCC      |L1.158|
;;;61     			}
;;;62     			Single_Cnt = 0;	
0000bc  2000              MOVS     r0,#0
0000be  4911              LDR      r1,|L1.260|
0000c0  7008              STRB     r0,[r1,#0]
0000c2  e018              B        |L1.246|
                  |L1.196|
;;;63     		}
;;;64     	}
;;;65     	else if(Single_num==0)//如果某一次中断计数火花个数为0，则重新进行滑动计数
0000c4  480c              LDR      r0,|L1.248|
0000c6  6800              LDR      r0,[r0,#0]  ; Single_num
0000c8  b9a8              CBNZ     r0,|L1.246|
;;;66     	{
;;;67     		//计数FIFO清零，重新计数
;;;68     		for(Cnt=0;Cnt<(sizeof(Spark)/sizeof(Spark[0]));Cnt++)
0000ca  2000              MOVS     r0,#0
0000cc  490b              LDR      r1,|L1.252|
0000ce  7008              STRB     r0,[r1,#0]
0000d0  e00a              B        |L1.232|
                  |L1.210|
;;;69     		{
;;;70     			Spark[Cnt] = 0;
0000d2  2000              MOVS     r0,#0
0000d4  490a              LDR      r1,|L1.256|
0000d6  4a09              LDR      r2,|L1.252|
0000d8  7812              LDRB     r2,[r2,#0]  ; Cnt
0000da  f8410022          STR      r0,[r1,r2,LSL #2]
0000de  4807              LDR      r0,|L1.252|
0000e0  7800              LDRB     r0,[r0,#0]            ;68  ; Cnt
0000e2  1c40              ADDS     r0,r0,#1              ;68
0000e4  4905              LDR      r1,|L1.252|
0000e6  7008              STRB     r0,[r1,#0]            ;68
                  |L1.232|
0000e8  4804              LDR      r0,|L1.252|
0000ea  7800              LDRB     r0,[r0,#0]            ;68  ; Cnt
0000ec  2805              CMP      r0,#5                 ;68
0000ee  d3f0              BCC      |L1.210|
;;;71     		}
;;;72     		Single_Cnt = 0;
0000f0  2000              MOVS     r0,#0
0000f2  4904              LDR      r1,|L1.260|
0000f4  7008              STRB     r0,[r1,#0]
                  |L1.246|
;;;73     	}			
;;;74     }
0000f6  4770              BX       lr
;;;75     
                          ENDP

                  |L1.248|
                          DCD      Single_num
                  |L1.252|
                          DCD      ||Cnt||
                  |L1.256|
                          DCD      Spark
                  |L1.260|
                          DCD      Single_Cnt
                  |L1.264|
                          DCD      Cir_Spark_Sum

                          AREA ||.bss||, DATA, NOINIT, ALIGN=2

                  Spark
                          %        20

                          AREA ||.data||, DATA, ALIGN=2

                  ||Cnt||
000000  00000000          DCB      0x00,0x00,0x00,0x00
                  Cir_Spark_Sum
                          DCD      0x00000000
                  Single_Cnt
000008  00                DCB      0x00
